1. Data
2. Software
3. Key commands

[TOC]

>为防止系统出现操作失误或系统故障导致数据丢失，我们需要将全部或部分数据集合从应用主机的硬盘或阵列复制到其它存储介质。

## Part1：备份知多少

### Q1：当我们谈备份时，我们在谈论着什么？
上周技能树里的小伙伴提到因为服务器断电而不慎丢失数据的悲惨事件，因此觉得有必要在这信息爆炸的时代学会保护自己的数据，不然哪天丢了都不知该怎么办好（经费充足且及时补救还存在数据恢复服务这一选项）。暗自推算，按照一般价格算50RMB/GB价格，恢复2000G的硬盘……

>![恢复价格](http://east2-image.oss-cn-shanghai.aliyuncs.com/18-12-12/67385809.jpg)
某网站的收费清单。。。

总之，做生信分析，还是得牢牢把控住数据源头啊。

### Q2：有什么备份的方式呢？
简单而言可以分成两类，一类是逻辑备份，另一类是物理备份。一般而言，个人用户主要采用物理备份中的冷备份。随着技术的不断发展，网络备份也越来越普及，网络备份一般通过专业的数据存储管理软件结合相应的硬件和存储设备来实现（常见的有各种网盘及其变种）。

>
 - 逻辑备份：指通过逻辑导出对数据进行备份。将数据库中的用户对象导出到一个二进制文件中，逻辑备份使用导入导出工具：EXPDP/IMPDP或EXP/IMP，由于将数据库对象导出到操作系统二进制文件中，或由二进制文件中把数据导入到数据库中。逻辑备份可以作为备份的补充方法，但是不要把逻辑备份当成唯一的数据库备份方案。逻辑备份则是对物理备份的方式的一种补充，由于逻辑备份具有平台无关性，逻辑备份被作为数据迁移及移动的主要手段。
 - 物理备份： 指通过物理文件拷贝的方式对数据库进行备份，物理备份又可以分为冷备份和热备份。
  + 冷备份：是指对数据库进行关闭后的拷贝备份，这样的备份具有一致和完整的时间点数据，恢复时只需要恢复所有文件就可以启动数据库；
  + 热备份：在生产系统中最常见的备份方式是热备份，进行热备份的数据库需要运行在归档模式，热备份时不需要关闭数据库，从而能够保证系统的持续运行，在进行恢复时，通过备份的数据文件及归档日志文件，数据库可以进行完全恢复。当然，如果是为了恢复某些用户错误，热备份的恢复完全可以在某一个时间点上停止恢复，也就是不完全恢复。

### Q3：我该从哪些角度进行完整备份？

数据的备份不同于整个系统备份，将不同数据按照优先级分类，根据用户需求，备份重要文件。使数据独立于操作系统，降低备份成本与时间。

首先我们得有一个对自己文件清楚的了解，避免冗余，减少备份系统的成本。其次根据要备份的文件估算备份需要的时间，也可以定期自动备份。

基本数据分类：
 - 用户数据、用户目录，及私人文件等。
 - 系统信息：系统用户、组、密码，主机列表等。
 - 应用程序：系统版本不变的备份可以镜像复制，但
 - 应用程序的配置文件与数据：针对不同的应用程序，不同的配置参数和重要数据文件。
 - 数据库：事实上数据库可以单独提供针对数据库所有数据的备份与同步功能。

适用于个人或者小型网站的备份策略：
 - 完全备份：适合于第一次备份或者忘记备份的内容是什么（之前备份的东西毫无价值。。）
 - 增量备份：第一次备份后，为了减少备份硬盘的再次读写和时间损耗，通常采取增量备份的策略


### Q4: 策略了解了，那数据存放的物理介质有什么选择吗？
1. 磁盘阵列柜：IT预算宽裕的企业的"宠儿"
2. 文件服务器：专门负责企业内部文件的管理与处理，文件服务器日常的数据管理及处理工作通常包括数据上传、下载、共享、存储、备份等，对于大多数中小企业而言是一个不错的选择
3. 光盘塔：光盘容量非常有限及购买光盘的花费大，刻录机寿命不长，人工操作，而且光盘易丢失、损坏，数据管理与恢复工作繁琐
4. 磁带机：建议结合其他存储设备一起使用，做到万无一失
5. NAS(网络附加存储)：已成为或即将成为主流！

>NAS英文全称为 Network Attached Storage，可译为网络附加存储，是一种专用网络数据存储备份设备。
它以数据为中心，将存储设备与服务器彻底分离，集中管理数据，从而释放网络带宽、提高性能、降低总拥有成本、提高IT投资的有效性。)NAS(网络附加存储)的构成将硬盘连起组成阵列，就是一个小型磁盘阵列柜，NAS本身内含CPU、内存、主板(与普通PC、服务器不同，中高端的NAS采用工业级标准的部件作为其硬件构成，自带操作系统，与通用操作系统不同 NAS采用的是嵌入式以LINNUX为内核的精简化(整个操作系统已去除多余媒体指令，整个系统仅仅数M的存储占用量)操作系统，工业级的部件结合精简化的操作系统使其具备独力工作的能力，作为专用的数据存储/备份设备，部分品牌NAS如IBM、HP、自由遁等品牌的部分产品已整合高度智能化、全自动的专业数据备份软件，几无地域限制结合优异的网络连接功能使它能够在本地、异地、远程的数据备份能力得到充分的展示，同时无地域限制限制布署容易，简易的操作大大提升了NAS易用性(IE式的管理与访问、操作界面让不需要太多的专业IT知识的操作人员也可轻松驾驭)。作为专门为数据存储、备份而生的存储设备，部分品牌NAS采取磁轨式数据备份技术，同时在数据备份方式方面除了完全数据备份以外，部分品牌(如IBM、EMC、自由遁等)的部分产品自带的备份软件中含有增量、差异数据备份方式。


## Part2：动手备份吧

不同的操作系统可能使用不同的数据备份方式，本文介绍了通用的 Unix/Linux 实用程序 tar以及远程备份工具 rsync，windows下则是freefilesync软件，大家也可以另行搜索（软件测评一大把，此处不再赘述）。

### Windows下的备份
一般而言，个人用户在windows系统下的备份可以比较粗暴。小编还少不更事的时候，采用的策略都是完全备份（简单粗暴，用U盘或者移动硬盘直接复制粘贴）。

软件的话freefilesync已可满足一般需求，具体可以到官网查看：https://freefilesync.org/
![](http://east2-image.oss-cn-shanghai.aliyuncs.com/18-12-12/37035110.jpg)


### Linux下的备份

#### 工具1：tar
![tar参数](http://east2-image.oss-cn-shanghai.aliyuncs.com/18-12-12/1166500.jpg)
![](http://east2-image.oss-cn-shanghai.aliyuncs.com/18-12-12/14906327.jpg)

#### 工具2：Rsync

rsync（Remote Sync）是 Unix/Linux 系统下一款优秀的数据备份与同步工具。它可以对文件集进行同步。然而更有价值的是，rsync 使用文件的增量，也就是说，它在网络中仅发送两个文件集合有区别的部分。这样可以占用更少的带宽，并且速度更快。能够实现增量备份、更新整个目录树和文件系统、本地备份及远程备份，以及保留文件权限、所有权、链接及更多对象在命令行上，使用脚本和计划任务，实现备份任务自动化。下期仔细讲讲这个工具。

常用参数：  
![](http://east2-image.oss-cn-shanghai.aliyuncs.com/18-12-12/48646572.jpg)

![](http://east2-image.oss-cn-shanghai.aliyuncs.com/18-12-12/8278760.jpg)
首次传输过程进行完全备份，当再次运行该命令时，rsync 将只传输数据的增量。从而完成增量备份。


### 小白，增加数据备份意识！

#### 措施1：平时注意避免物理损伤习惯（他人含泪总结！）

由于没有经历过损失数据这样惨痛DIY经历，特摘录他人教训一份（引自知乎，【数据备份】- 含泪总结：如何保护自己的重要数据？ - Steven的文章 https://zhuanlan.zhihu.com/p/29157250）
1. 尽可能的多备份几份数据，最好台式机备份一份，移动硬盘备份一份。（移动硬盘很容易被摔，台式机比较稳定，数据损失的可能性低，但要预防病毒）      
2. 备份用的硬盘最好使用WD（西部数据），西部数据的转速只有5400转/分，而希捷、三星的硬盘转速高达7200转/分，硬盘转速越快，数据读取快，硬盘价格也贵，但数据损坏的概率也就大很多了。盘面旋转快，被划伤的可能性就会很大。       
3. 硬盘被摔后，不要频繁通电。有些小伙伴在磁盘摔了后，频繁通电检测，非常容易导致数据的全部丢失，因为磁头可能还在划伤盘面，导致数据恢复的可能性大幅降低，甚至无法恢复。       
4. 硬盘数据不要使用第三方加密程序或加密狗加密，尤其是某些公司购买的全国没几人能够解密的加密软件进行加密，导致数据完全无法恢复。       
5. 数据备份尽量不要使用SSD（固态硬盘），因为固态硬盘不会轻易坏，但坏了数据恢复的可能性很低，而且恢复成本也非常高。


#### 措施2：我的硬盘已经毁了，怎么整？
好吧，你备份了吗？在追悔之余，还是赶快学习一下这期推送的内容吧，下次就有底了。

### 参考
[1]数据无价 谨慎备份----论数据备份的重要性[EB/OL]. 知乎专栏, [2018-12-12]. https://zhuanlan.zhihu.com/p/24648648.
[2]数据库备份的分类 - Paul’s Notes - CSDN博客[EB/OL]. [2018-12-12]. https://blog.csdn.net/pan_tian/article/details/42198909.
[3]全量、增量、差异备份，这个故事讲得很透[EB/OL]. 知乎专栏, [2018-12-12]. https://zhuanlan.zhihu.com/p/28783571.
[4]冷数据备份存储技术探索 - 云+社区 - 腾讯云[EB/OL]. [2018-12-12]. https://cloud.tencent.com/developer/article/1030061.
[5]教程：数据备份存储设备分类 - 51CTO.COM[EB/OL]. [2018-12-12]. http://stor.51cto.com/art/200808/86043.htm.
[6]个人数据备份的常见方案-月光博客[EB/OL]. [2018-12-12]. https://www.williamlong.info/archives/4381.html.
[7]【数据备份】- 含泪总结：如何保护自己的重要数据？[EB/OL]. 知乎专栏, [2018-12-12]. https://zhuanlan.zhihu.com/p/29157250.


---
http://www.cnic.cas.cn/zcfw/sjfw/sjzyzx/xxfw_sdb03/201007/t20100730_2915568.html

#### 其他备份工具资源


1. Backupninja
这款功能强大的备份工具让用户可以备份活动配置文件，这些文件可以放入到/etc/backup.d/目录。它有助于通过网络，执行安全的远程备份以及增量备份。

主要功能：
易于读取ini式样的配置文件
使用脚本处理你系统上新类型的备份
计划并安排备份何时进行
用户可以选择用于状态报告的电子邮件何时发送给自己。
可使用基于控制台的向导(ninjahelper)，轻松构建备份操作配置文件。
可与Linux-Vserver协同运行。

2. Kbackup

![Kbackup_sct](https://dn-linuxcn.qbox.me/data/attachment/album/201604/02/213904c6zduqwqhidz65u5.png)
这款易于使用的备份工具面向Unix操作系统，可以在Linux上使用。它可以构建归档文件，然后分别使用tar和gzip实用工具来进行压缩。
Kbackup具有下列功能：
易于使用、菜单驱动的界面。
支持压缩、加密和双重缓存。
自动化无人值守备份。
高度可靠。
支持完全备份或增量备份。
跨网络进行远程备份。

3. Back Time
![](https://dn-linuxcn.qbox.me/data/attachment/album/201604/02/213904p1dx6s1cbs2dggg9.png)
这是一款简单的、易于使用的备份工具，面向Linux操作系统，它可以对指定的目录拍取快照，然后加以备份。

它具有配置等功能，比如可以配置：

保存快照的存储位置。
手动或自动备份。
备份目录。
